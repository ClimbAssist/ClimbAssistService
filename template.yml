AWSTemplateFormatVersion: 2010-09-09

Parameters:
  EBTrustRole:
    Type: String
    Description: The service role in IAM for AWS Elastic Beanstalk to be created for this project.
  ResourceNameSuffix:
    Type: String
    Description: Suffix to be applied to the end of resource names to support developer stacks.
    Default: ''
  CreateComputeResources:
    Type: String
    Description: Specifies whether compute resources (Elastic Beanstalk environment, execution roles, domain mapping, etc.) should be created
    AllowedValues:
    - true
    - false
    Default: true
  Stage:
    Type: String
    AllowedValues:
    - dev
    - beta
    - prod

Conditions:
  IsProd:
    Fn::Equals:
    - !Ref ResourceNameSuffix
    - ''
  CreateComputeResources:
    Fn::Equals:
    - !Ref CreateComputeResources
    - true
  IsProdAndCreateComputeResources:
    Fn::And:
    - Condition: IsProd
    - Condition: CreateComputeResources

Outputs:
  CognitoUserPoolId:
    Value: !Ref UserPool

Resources:

  # VPC and Subnets
  Vpc:
    Type: AWS::EC2::VPC
    Condition: CreateComputeResources
    Properties:
      CidrBlock: 10.0.0.0/16
      EnableDnsSupport: true
      EnableDnsHostnames: true
      InstanceTenancy: default
      Tags:
      - Key: Name
        Value: !Sub ClimbAssistVpc${ResourceNameSuffix}
  InternetGateway:
    Type: AWS::EC2::InternetGateway
    Condition: CreateComputeResources
  VpcGatewayAttachment:
    Type: AWS::EC2::VPCGatewayAttachment
    Condition: CreateComputeResources
    Properties:
      InternetGatewayId: !Ref InternetGateway
      VpcId: !Ref Vpc
  SubnetA:
    Type: AWS::EC2::Subnet
    Condition: CreateComputeResources
    Properties:
      AvailabilityZone: us-west-2a
      CidrBlock: 10.0.0.0/17
      MapPublicIpOnLaunch: true
      VpcId: !Ref Vpc
  SubnetB:
    Type: AWS::EC2::Subnet
    Condition: CreateComputeResources
    Properties:
      AvailabilityZone: us-west-2b
      CidrBlock: 10.0.128.0/18
      MapPublicIpOnLaunch: true
      VpcId: !Ref Vpc
  SubnetC:
    Type: AWS::EC2::Subnet
    Condition: CreateComputeResources
    Properties:
      AvailabilityZone: us-west-2c
      CidrBlock: 10.0.192.0/18
      MapPublicIpOnLaunch: true
      VpcId: !Ref Vpc
  SecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Condition: CreateComputeResources
    Properties:
      GroupDescription: Security group for Climb Assist Elastic Beanstalk application
      SecurityGroupIngress:
      - CidrIp: '0.0.0.0/0'
        IpProtocol: tcp
        FromPort: 80
        ToPort: 80
      - CidrIp: '0.0.0.0/0'
        IpProtocol: tcp
        FromPort: 22
        ToPort: 22
      SecurityGroupEgress:
      - CidrIp: '0.0.0.0/0'
        IpProtocol: '-1' # all protocols
        ToPort: 0
        FromPort: 65535
      VpcId: !Ref Vpc
  RouteTable:
    Type: AWS::EC2::RouteTable
    Condition: CreateComputeResources
    Properties:
      VpcId: !Ref Vpc
  Route:
    Type: AWS::EC2::Route
    Condition: CreateComputeResources
    DependsOn: VpcGatewayAttachment
    Properties:
      RouteTableId: !Ref RouteTable
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway
  SubnetARouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Condition: CreateComputeResources
    Properties:
      RouteTableId: !Ref RouteTable
      SubnetId: !Ref SubnetA
  SubnetBRouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Condition: CreateComputeResources
    Properties:
      RouteTableId: !Ref RouteTable
      SubnetId: !Ref SubnetB
  SubnetCRouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Condition: CreateComputeResources
    Properties:
      RouteTableId: !Ref RouteTable
      SubnetId: !Ref SubnetC

  # Elastic Beanstalk environment
  EBApplication:
    Type: AWS::ElasticBeanstalk::Application
    Condition: CreateComputeResources
    Properties:
      ApplicationName: !Sub climbassistapp${ResourceNameSuffix}
      Description: The name of the AWS Elastic Beanstalk application to be created for this project.
  EBApplicationVersion:
    Type: AWS::ElasticBeanstalk::ApplicationVersion
    Condition: CreateComputeResources
    DependsOn: ApplicationLogGroup
    Properties:
      ApplicationName: !Ref EBApplication
      Description: The application version number.
      SourceBundle: target/ROOT
  EBConfigurationTemplate:
    Type: AWS::ElasticBeanstalk::ConfigurationTemplate
    Condition: CreateComputeResources
    Properties:
      ApplicationName: !Ref EBApplication
      Description: The name of the sample common template.
      OptionSettings:
      - Namespace: aws:elasticbeanstalk:environment
        OptionName: EnvironmentType
        Value: LoadBalanced
      - Namespace: aws:elasticbeanstalk:environment
        OptionName: ServiceRole
        Value: !Ref EBTrustRole
      - Namespace: aws:elasticbeanstalk:healthreporting:system
        OptionName: SystemType
        Value: enhanced
      SolutionStackName: 64bit Amazon Linux 2018.03 v3.3.8 running Tomcat 8.5 Java 8
  EBEnvironment:
    Type: AWS::ElasticBeanstalk::Environment
    Condition: CreateComputeResources
    Properties:
      ApplicationName: !Ref EBApplication
      EnvironmentName: !Ref EBApplication
      CNAMEPrefix: !Sub climbassist${ResourceNameSuffix}
      TemplateName: !Ref EBConfigurationTemplate
      VersionLabel: !Ref EBApplicationVersion
      OptionSettings:
      - Namespace: aws:autoscaling:launchconfiguration
        OptionName: IamInstanceProfile
        Value: !GetAtt EBInstanceProfile.Arn
      - Namespace: aws:autoscaling:launchconfiguration
        OptionName: InstanceType
        Value: t2.micro
      - Namespace: aws:autoscaling:launchconfiguration
        OptionName: EC2KeyName
        Value: climb-assist
        # Rolling updates
      - Namespace: aws:autoscaling:updatepolicy:rollingupdate
        OptionName: RollingUpdateEnabled
        Value: 'true'
      - Namespace: aws:autoscaling:updatepolicy:rollingupdate
        OptionName: RollingUpdateType
        Value: Health
        # Auto updates
      - Namespace: aws:elasticbeanstalk:managedactions
        OptionName: ManagedActionsEnabled
        Value: 'true'
      - Namespace: aws:elasticbeanstalk:managedactions
        OptionName: PreferredStartTime
        Value: Sun:07:00 # Sunday at Midnight in PST
      - Namespace: aws:elasticbeanstalk:managedactions:platformupdate
        OptionName: UpdateLevel
        Value: minor
        # VPC configuration
      - Namespace: aws:ec2:vpc
        OptionName: VPCId
        Value: !Ref Vpc
      - Namespace: aws:ec2:vpc
        OptionName: Subnets
        Value:
          Fn::Join:
          - ','
          - - !Ref SubnetA
            - !Ref SubnetB
            - !Ref SubnetC
      - Namespace: aws:autoscaling:launchconfiguration
        OptionName: SecurityGroups
        Value: !Ref SecurityGroup
      - Namespace: aws:ec2:vpc
        OptionName: AssociatePublicIpAddress
        Value: 'true'
      - Namespace: aws:autoscaling:asg
        OptionName: MinSize
        Value: 2
      - Namespace: aws:elasticbeanstalk:environment
        OptionName: LoadBalancerType
        Value: application
      - Namespace: aws:elbv2:listener:443
        OptionName: DefaultProcess
        Value: https
      - Namespace: aws:elbv2:listener:443
        OptionName: ListenerEnabled
        Value: 'true'
      - Namespace: aws:elbv2:listener:443
        OptionName: Protocol
        Value: HTTPS
      - Namespace: aws:elasticbeanstalk:environment:process:https
        OptionName: Port
        Value: '443'
      - Namespace: aws:elasticbeanstalk:environment:process:https
        OptionName: Protocol
        Value: HTTPS
      - Namespace: aws:elbv2:listener:443
        OptionName: SSLCertificateArns
        Value:
          Fn::If:
          - IsProd
          # real certificate, created by hand
          - arn:aws:acm:us-west-2:172776452117:certificate/c08fcc8a-339c-477d-8dfd-980b3707100e
          # self-signed certificate for development only, created by hand
          - arn:aws:acm:us-west-2:172776452117:certificate/3f07e663-e2cb-457c-9e22-bc5d653d180c
      - Namespace: aws:elasticbeanstalk:environment:process:default
        OptionName: HealthCheckPath
        Value: /health
      - Namespace: aws:elasticbeanstalk:environment:process:https
        OptionName: HealthCheckPath
        Value: /health
        # Logging common
      - Namespace: aws:elasticbeanstalk:cloudwatch:logs
        OptionName: StreamLogs
        Value: 'true'
      - Namespace: aws:elasticbeanstalk:cloudwatch:logs
        OptionName: RetentionInDays
        Value:
          Fn::If:
          - IsProd
          - 3653 # 10 years
          - 1 # 1 day
        # Environment variables
      - Namespace: aws:elasticbeanstalk:application:environment
        OptionName: region
        Value: !Ref AWS::Region
      - Namespace: aws:elasticbeanstalk:application:environment
        OptionName: resourceNameSuffix
        Value: !Ref ResourceNameSuffix
      - Namespace: aws:elasticbeanstalk:application:environment
        OptionName: userPoolId
        Value: !Ref UserPool
      - Namespace: aws:elasticbeanstalk:application:environment
        OptionName: userPoolClientId
        Value: !Ref UserPoolClient
      - Namespace: aws:elasticbeanstalk:application:environment
        OptionName: accountId
        Value: !Ref AWS::AccountId
      - Namespace: aws:elasticbeanstalk:application:environment
        OptionName: climbAssistEmail
        Value:
          Fn::If:
          - IsProd
          - info@climbassist.com
          # this strips out the '-' from the beginning of ResourceNameSuffix and then appends '@climbassist.com'
          - !Sub
            - ${Name}@climbassist.com
            - { Name: !Select [1, !Split ['-', !Ref ResourceNameSuffix]] }
      - Namespace: aws:elasticbeanstalk:application:environment
        OptionName: stage
        Value: !Ref Stage
      - Namespace: aws:elasticbeanstalk:application:environment
        OptionName: userDataRetentionTimeMinutes
        Value:
          Fn::If:
          - IsProd
          - 1051200 # 2 years
          - 1 # this avoids our dev and beta tables from getting filled up with deleted users from integration tests
      - Namespace: aws:elasticbeanstalk:application:environment
        OptionName: recaptchaBackDoorResponseSecretId
        Value: !Sub RecaptchaBackDoorResponse${ResourceNameSuffix}
  EBInstanceProfile:
    Type: AWS::IAM::InstanceProfile
    Condition: CreateComputeResources
    Properties:
      Roles:
      - !Ref EBWorkerRole
  EBWorkerRole:
    Type: AWS::IAM::Role
    Condition: CreateComputeResources
    Properties:
      RoleName: !Sub ClimbAssistElasticBeanstalkWorkerRole${ResourceNameSuffix}
      AssumeRolePolicyDocument:
        Statement:
        - Action: sts:AssumeRole
          Effect: Allow
          Principal:
            Service: ec2.amazonaws.com
        Version: 2012-10-17
      Policies:
      - PolicyName: EBInstancePolicy
        PolicyDocument:
          Statement:
          - Action:
            - logs:CreateLogGroup
            - logs:CreateLogStream
            - logs:GetLogEvents
            - logs:PutLogEvents
            - logs:DescribeLogGroups
            - logs:DescribeLogStreams
            - logs:PutRetentionPolicy
            Effect: Allow
            Resource: '*'
          - Action:
            - dynamoDB:GetItem
            - dynamoDB:Query
            - dynamoDB:Scan
            - dynamoDB:PutItem
            - dynamoDB:UpdateItem
            - dynamoDB:DeleteItem
            Effect: Allow
            Resource:
            - !Sub
              - ${TableArn}*
              - TableArn: !GetAtt CountriesTable.Arn
            - !Sub
              - ${TableArn}*
              - TableArn: !GetAtt RegionsTable.Arn
            - !Sub
              - ${TableArn}*
              - TableArn: !GetAtt AreasTable.Arn
            - !Sub
              - ${TableArn}*
              - TableArn: !GetAtt SubAreasTable.Arn
            - !Sub
              - ${TableArn}*
              - TableArn: !GetAtt CragsTable.Arn
            - !Sub
              - ${TableArn}*
              - TableArn: !GetAtt WallsTable.Arn
            - !Sub
              - ${TableArn}*
              - TableArn: !GetAtt RoutesTable.Arn
            - !Sub
              - ${TableArn}*
              - TableArn: !GetAtt PitchesTable.Arn
            - !Sub
              - ${TableArn}*
              - TableArn: !GetAtt PointsTable.Arn
            - !Sub
              - ${TableArn}*
              - TableArn: !GetAtt PathsTable.Arn
            - !Sub
              - ${TableArn}*
              - TableArn: !GetAtt PathPointsTable.Arn
            - !Sub
              - ${TableArn}*
              - TableArn: !GetAtt RouteCommentsTable.Arn
            - !Sub
              - ${TableArn}*
              - TableArn: !GetAtt DeletedUsersTable.Arn
          - Action:
            - cognito-idp:SignUp
            - cognito-idp:InitiateAuth
            - cognito-idp:GetUser
            - cognito-idp:AdminListGroupsForUser
            - cognito-idp:ListUsers
            Effect: Allow
            Resource: !GetAtt UserPool.Arn
          - Action:
            - s3:GetObject
            - s3:PutObject
            - s3:PutObjectAcl
            - s3:DeleteObject
            Effect: Allow
            Resource:
            - !Sub
              - ${BucketArn}*
              - BucketArn: !GetAtt ModelsS3Bucket.Arn
            - !Sub
              - ${BucketArn}*
              - BucketArn: !GetAtt MapDataS3Bucket.Arn
            - !Sub
              - ${BucketArn}*
              - BucketArn: !GetAtt PhotosS3Bucket.Arn
          - Action: cloudwatch:PutMetricData
            Effect: Allow
            Resource: '*'
          - Action: ses:SendEmail
            Effect: Allow
            Resource: !GetAtt SesVerifiedEmailIdentity.Arn
          - Action: secretsmanager:GetSecretValue
            Effect: Allow
            Resource:
            - arn:aws:secretsmanager:us-west-2:172776452117:secret:ClimbAssistRsaPrivateKey-mzRTKi # created by hand
            - arn:aws:secretsmanager:us-west-2:172776452117:secret:ClimbAssistRecaptchaKeys* # created by hand
            - !Ref RecaptchaBackDoorResponseSecret
      ManagedPolicyArns:
      - arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier

  # This maps climbassist.com to the Elastic Beanstalk domain
  RecordSet:
    Type: AWS::Route53::RecordSet
    Condition: IsProdAndCreateComputeResources
    Properties:
      AliasTarget:
        DNSName: !Sub climbassist${ResourceNameSuffix}.${AWS::Region}.elasticbeanstalk.com
        HostedZoneId: Z38NKT9BP95V3O # From https://docs.aws.amazon.com/general/latest/gr/elasticbeanstalk.html
      HostedZoneName: climbassist.com.
      Name: climbassist.com
      Type: A

  # This maps www.climbassist.com to the Elastic Beanstalk domain
  WwwRecordSet:
    Type: AWS::Route53::RecordSet
    Condition: IsProdAndCreateComputeResources
    Properties:
      AliasTarget:
        DNSName: !Sub climbassist${ResourceNameSuffix}.${AWS::Region}.elasticbeanstalk.com
        HostedZoneId: Z38NKT9BP95V3O # From https://docs.aws.amazon.com/general/latest/gr/elasticbeanstalk.html
      HostedZoneName: climbassist.com.
      Name: www.climbassist.com
      Type: A

  ApplicationLogGroup:
    Type: AWS::Logs::LogGroup
    Condition: CreateComputeResources
    Properties:
      LogGroupName: !Sub /aws/elasticbeanstalk/${EBApplication}/var/log/application.log
      RetentionInDays:
        Fn::If:
        - IsProd
        - 3653 # 10 years
        - 1 # 1 day

  # DynamoDB tables
  DynamoDbAutoScalingRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub DynamoDbAutoScalingRole${ResourceNameSuffix}
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Principal:
            Service: application-autoscaling.amazonaws.com
          Action: sts:AssumeRole
      Path: /
      Policies:
      - PolicyName: root
        PolicyDocument:
          Version: '2012-10-17'
          Statement:
          - Effect: Allow
            Action:
            - dynamodb:DescribeTable
            - dynamodb:UpdateTable
            - cloudwatch:PutMetricAlarm
            - cloudwatch:DescribeAlarms
            - cloudwatch:GetMetricStatistics
            - cloudwatch:SetAlarmState
            - cloudwatch:DeleteAlarms
            Resource: '*'

  CountriesTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub Countries${ResourceNameSuffix}
      AttributeDefinitions:
      - AttributeName: countryId
        AttributeType: S
      KeySchema:
      - AttributeName: countryId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: true
  CountriesTableWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${CountriesTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:WriteCapacityUnits
      ServiceNamespace: dynamodb
  CountriesTableWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub CountriesTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref CountriesTableWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  CountriesTableReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${CountriesTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:ReadCapacityUnits
      ServiceNamespace: dynamodb
  CountriesTableReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub CountriesTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref CountriesTableReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization

  RegionsTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub Regions${ResourceNameSuffix}
      AttributeDefinitions:
      - AttributeName: regionId
        AttributeType: S
      - AttributeName: countryId
        AttributeType: S
      KeySchema:
      - AttributeName: regionId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
      GlobalSecondaryIndexes:
      - IndexName: CountryIndex
        KeySchema:
        - AttributeName: countryId
          KeyType: HASH
        Projection:
          ProjectionType: ALL
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: true
  RegionsTableWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${RegionsTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:WriteCapacityUnits
      ServiceNamespace: dynamodb
  RegionsTableWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub RegionsTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref RegionsTableWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  RegionsTableReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${RegionsTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:ReadCapacityUnits
      ServiceNamespace: dynamodb
  RegionsTableReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub RegionsTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref RegionsTableReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization
  RegionsTableIndexWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${RegionsTable}/index/CountryIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:WriteCapacityUnits
      ServiceNamespace: dynamodb
  RegionsTableIndexWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub RegionsTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref RegionsTableIndexWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  RegionsTableIndexReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${RegionsTable}/index/CountryIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:ReadCapacityUnits
      ServiceNamespace: dynamodb
  RegionsTableIndexReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub RegionsTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref RegionsTableIndexReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization

  AreasTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub Areas${ResourceNameSuffix}
      AttributeDefinitions:
      - AttributeName: areaId
        AttributeType: S
      - AttributeName: regionId
        AttributeType: S
      KeySchema:
      - AttributeName: areaId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
      GlobalSecondaryIndexes:
      - IndexName: RegionIndex
        KeySchema:
        - AttributeName: regionId
          KeyType: HASH
        Projection:
          ProjectionType: ALL
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: true
  AreasTableWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${AreasTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:WriteCapacityUnits
      ServiceNamespace: dynamodb
  AreasTableWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub AreasTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref AreasTableWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  AreasTableReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${AreasTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:ReadCapacityUnits
      ServiceNamespace: dynamodb
  AreasTableReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub AreasTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref AreasTableReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization
  AreasTableIndexWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${AreasTable}/index/RegionIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:WriteCapacityUnits
      ServiceNamespace: dynamodb
  AreasTableIndexWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub AreasTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref AreasTableIndexWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  AreasTableIndexReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${AreasTable}/index/RegionIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:ReadCapacityUnits
      ServiceNamespace: dynamodb
  AreasTableIndexReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub AreasTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref AreasTableIndexReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization

  SubAreasTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub SubAreas${ResourceNameSuffix}
      AttributeDefinitions:
      - AttributeName: subAreaId
        AttributeType: S
      - AttributeName: areaId
        AttributeType: S
      KeySchema:
      - AttributeName: subAreaId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
      GlobalSecondaryIndexes:
      - IndexName: AreaIndex
        KeySchema:
        - AttributeName: areaId
          KeyType: HASH
        Projection:
          ProjectionType: ALL
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: true
  SubAreasTableWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${SubAreasTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:WriteCapacityUnits
      ServiceNamespace: dynamodb
  SubAreasTableWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub SubAreasTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref SubAreasTableWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  SubAreasTableReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${SubAreasTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:ReadCapacityUnits
      ServiceNamespace: dynamodb
  SubAreasTableReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub SubAreasTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref SubAreasTableReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization
  SubAreasTableIndexWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${SubAreasTable}/index/AreaIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:WriteCapacityUnits
      ServiceNamespace: dynamodb
  SubAreasTableIndexWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub SubAreasTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref SubAreasTableIndexWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  SubAreasTableIndexReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${SubAreasTable}/index/AreaIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:ReadCapacityUnits
      ServiceNamespace: dynamodb
  SubAreasTableIndexReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub SubAreasTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref SubAreasTableIndexReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization

  CragsTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub Crags${ResourceNameSuffix}
      AttributeDefinitions:
      - AttributeName: cragId
        AttributeType: S
      - AttributeName: subAreaId
        AttributeType: S
      KeySchema:
      - AttributeName: cragId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
      GlobalSecondaryIndexes:
      - IndexName: SubAreaIndex
        KeySchema:
        - AttributeName: subAreaId
          KeyType: HASH
        Projection:
          ProjectionType: ALL
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: true
  CragsTableWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${CragsTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:WriteCapacityUnits
      ServiceNamespace: dynamodb
  CragsTableWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub CragsTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref CragsTableWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  CragsTableReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${CragsTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:ReadCapacityUnits
      ServiceNamespace: dynamodb
  CragsTableReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub CragsTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref CragsTableReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization
  CragsTableIndexWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${CragsTable}/index/SubAreaIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:WriteCapacityUnits
      ServiceNamespace: dynamodb
  CragsTableIndexWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub CragsTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref CragsTableIndexWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  CragsTableIndexReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${CragsTable}/index/SubAreaIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:ReadCapacityUnits
      ServiceNamespace: dynamodb
  CragsTableIndexReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub CragsTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref CragsTableIndexReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization

  WallsTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub Walls${ResourceNameSuffix}
      AttributeDefinitions:
      - AttributeName: wallId
        AttributeType: S
      - AttributeName: cragId
        AttributeType: S
      KeySchema:
      - AttributeName: wallId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
      GlobalSecondaryIndexes:
      - IndexName: CragIndex
        KeySchema:
        - AttributeName: cragId
          KeyType: HASH
        Projection:
          ProjectionType: ALL
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: true
  WallsTableWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${WallsTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:WriteCapacityUnits
      ServiceNamespace: dynamodb
  WallsTableWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub WallsTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref WallsTableWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  WallsTableReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${WallsTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:ReadCapacityUnits
      ServiceNamespace: dynamodb
  WallsTableReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub WallsTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref WallsTableReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization
  WallsTableIndexWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${WallsTable}/index/CragIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:WriteCapacityUnits
      ServiceNamespace: dynamodb
  WallsTableIndexWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub WallsTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref WallsTableIndexWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  WallsTableIndexReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${WallsTable}/index/CragIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:ReadCapacityUnits
      ServiceNamespace: dynamodb
  WallsTableIndexReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub WallsTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref WallsTableIndexReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization

  RoutesTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub Routes${ResourceNameSuffix}
      AttributeDefinitions:
      - AttributeName: routeId
        AttributeType: S
      - AttributeName: wallId
        AttributeType: S
      KeySchema:
      - AttributeName: routeId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
      GlobalSecondaryIndexes:
      - IndexName: WallIndex
        KeySchema:
        - AttributeName: wallId
          KeyType: HASH
        Projection:
          ProjectionType: ALL
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: true
  RoutesTableWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${RoutesTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:WriteCapacityUnits
      ServiceNamespace: dynamodb
  RoutesTableWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub RoutesTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref RoutesTableWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  RoutesTableReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${RoutesTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:ReadCapacityUnits
      ServiceNamespace: dynamodb
  RoutesTableReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub RoutesTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref RoutesTableReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization
  RoutesTableIndexWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${RoutesTable}/index/WallIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:WriteCapacityUnits
      ServiceNamespace: dynamodb
  RoutesTableIndexWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub RoutesTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref RoutesTableIndexWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  RoutesTableIndexReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${RoutesTable}/index/WallIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:ReadCapacityUnits
      ServiceNamespace: dynamodb
  RoutesTableIndexReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub RoutesTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref RoutesTableIndexReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization

  PitchesTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub Pitches${ResourceNameSuffix}
      AttributeDefinitions:
      - AttributeName: pitchId
        AttributeType: S
      - AttributeName: routeId
        AttributeType: S
      KeySchema:
      - AttributeName: pitchId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
      GlobalSecondaryIndexes:
      - IndexName: RouteIndex
        KeySchema:
        - AttributeName: routeId
          KeyType: HASH
        Projection:
          ProjectionType: ALL
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: true
  PitchesTableWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${PitchesTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:WriteCapacityUnits
      ServiceNamespace: dynamodb
  PitchesTableWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub PitchesTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref PitchesTableWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  PitchesTableReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${PitchesTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:ReadCapacityUnits
      ServiceNamespace: dynamodb
  PitchesTableReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub PitchesTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref PitchesTableReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization
  PitchesTableIndexWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${PitchesTable}/index/RouteIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:WriteCapacityUnits
      ServiceNamespace: dynamodb
  PitchesTableIndexWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub PitchesTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref PitchesTableIndexWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  PitchesTableIndexReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${PitchesTable}/index/RouteIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:ReadCapacityUnits
      ServiceNamespace: dynamodb
  PitchesTableIndexReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub PitchesTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref PitchesTableIndexReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization

  PointsTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub Points${ResourceNameSuffix}
      AttributeDefinitions:
      - AttributeName: pointId
        AttributeType: S
      - AttributeName: pitchId
        AttributeType: S
      KeySchema:
      - AttributeName: pointId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
      GlobalSecondaryIndexes:
      - IndexName: PitchIndex
        KeySchema:
        - AttributeName: pitchId
          KeyType: HASH
        Projection:
          ProjectionType: ALL
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: true
  PointsTableWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${PointsTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:WriteCapacityUnits
      ServiceNamespace: dynamodb
  PointsTableWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub PointsTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref PointsTableWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  PointsTableReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${PointsTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:ReadCapacityUnits
      ServiceNamespace: dynamodb
  PointsTableReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub PointsTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref PointsTableReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization
  PointsTableIndexWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${PointsTable}/index/PitchIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:WriteCapacityUnits
      ServiceNamespace: dynamodb
  PointsTableIndexWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub PointsTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref PointsTableIndexWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  PointsTableIndexReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${PointsTable}/index/PitchIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:ReadCapacityUnits
      ServiceNamespace: dynamodb
  PointsTableIndexReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub PointsTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref PointsTableIndexReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization

  PathsTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub Paths${ResourceNameSuffix}
      AttributeDefinitions:
      - AttributeName: pathId
        AttributeType: S
      - AttributeName: cragId
        AttributeType: S
      KeySchema:
      - AttributeName: pathId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
      GlobalSecondaryIndexes:
      - IndexName: CragIndex
        KeySchema:
        - AttributeName: cragId
          KeyType: HASH
        Projection:
          ProjectionType: ALL
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: true
  PathsTableWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${PathsTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:WriteCapacityUnits
      ServiceNamespace: dynamodb
  PathsTableWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub PathsTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref PathsTableWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  PathsTableReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${PathsTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:ReadCapacityUnits
      ServiceNamespace: dynamodb
  PathsTableReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub PathsTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref PathsTableReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization
  PathsTableIndexWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${PathsTable}/index/CragIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:WriteCapacityUnits
      ServiceNamespace: dynamodb
  PathsTableIndexWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub PathsTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref PathsTableIndexWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  PathsTableIndexReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${PathsTable}/index/CragIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:ReadCapacityUnits
      ServiceNamespace: dynamodb
  PathsTableIndexReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub PathsTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref PathsTableIndexReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization

  PathPointsTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub PathPoints${ResourceNameSuffix}
      AttributeDefinitions:
      - AttributeName: pathPointId
        AttributeType: S
      - AttributeName: pathId
        AttributeType: S
      KeySchema:
      - AttributeName: pathPointId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
      GlobalSecondaryIndexes:
      - IndexName: PathIndex
        KeySchema:
        - AttributeName: pathId
          KeyType: HASH
        Projection:
          ProjectionType: ALL
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: true
  PathPointsTableWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${PathPointsTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:WriteCapacityUnits
      ServiceNamespace: dynamodb
  PathPointsTableWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub PathPointsTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref PathPointsTableWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  PathPointsTableReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${PathPointsTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:ReadCapacityUnits
      ServiceNamespace: dynamodb
  PathPointsTableReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub PathPointsTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref PathPointsTableReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization
  PathPointsTableIndexWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${PathPointsTable}/index/PathIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:WriteCapacityUnits
      ServiceNamespace: dynamodb
  PathPointsTableIndexWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub PathPointsTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref PathPointsTableIndexWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  PathPointsTableIndexReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${PathPointsTable}/index/PathIndex
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:index:ReadCapacityUnits
      ServiceNamespace: dynamodb
  PathPointsTableIndexReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub PathPointsTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref PathPointsTableIndexReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization

  RouteCommentsTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub RouteComments${ResourceNameSuffix}
      AttributeDefinitions:
      - AttributeName: routeCommentId
        AttributeType: S
      - AttributeName: routeId
        AttributeType: S
      KeySchema:
      - AttributeName: routeCommentId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
      GlobalSecondaryIndexes:
      - IndexName: RouteIndex
        KeySchema:
        - AttributeName: routeId
          KeyType: HASH
        Projection:
          ProjectionType: ALL
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: true
  RouteCommentsTableWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${RouteCommentsTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:WriteCapacityUnits
      ServiceNamespace: dynamodb
  RouteCommentsTableWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub RouteCommentsTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref RouteCommentsTableWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  RouteCommentsTableReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${RouteCommentsTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:ReadCapacityUnits
      ServiceNamespace: dynamodb
  RouteCommentsTableReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub RouteCommentsTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref RouteCommentsTableReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization

  DeletedUsersTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub DeletedUsers${ResourceNameSuffix}
      AttributeDefinitions:
      - AttributeName: userId
        AttributeType: S
      - AttributeName: username
        AttributeType: S
      - AttributeName: email
        AttributeType: S
      KeySchema:
      - AttributeName: userId
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
      GlobalSecondaryIndexes:
      - IndexName: UsernameIndex
        KeySchema:
        - AttributeName: username
          KeyType: HASH
        Projection:
          ProjectionType: ALL
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
      - IndexName: EmailIndex
        KeySchema:
        - AttributeName: email
          KeyType: HASH
        Projection:
          ProjectionType: ALL
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: true
      TimeToLiveSpecification:
        Enabled: true
        AttributeName: expirationTime

  DeletedUsersTableWriteCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${DeletedUsersTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:WriteCapacityUnits
      ServiceNamespace: dynamodb
  DeletedUsersTableWriteAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub DeletedUsersTableWriteAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref DeletedUsersTableWriteCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBWriteCapacityUtilization
  DeletedUsersTableReadCapacityScalableTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: 100
      MinCapacity: 1
      ResourceId: !Sub table/${DeletedUsersTable}
      RoleARN: !GetAtt DynamoDbAutoScalingRole.Arn
      ScalableDimension: dynamodb:table:ReadCapacityUnits
      ServiceNamespace: dynamodb
  DeletedUsersTableReadAutoScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub DeletedUsersTableReadAutoScalingPolicy${ResourceNameSuffix}
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref DeletedUsersTableReadCapacityScalableTarget
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 70
        ScaleInCooldown: 60
        ScaleOutCooldown: 60
        PredefinedMetricSpecification:
          PredefinedMetricType: DynamoDBReadCapacityUtilization


  # S3 buckets
  ModelsS3Bucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub models-${AWS::AccountId}-${AWS::Region}${ResourceNameSuffix}
      AccessControl: PublicRead
      VersioningConfiguration:
        Status: Enabled
  MapDataS3Bucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub map-data-${AWS::AccountId}-${AWS::Region}${ResourceNameSuffix}
      AccessControl: PublicRead
  PhotosS3Bucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub photos-${AWS::AccountId}-${AWS::Region}${ResourceNameSuffix}
      AccessControl: PublicRead

  # Cognito
  UserPool:
    Type: AWS::Cognito::UserPool
    Properties:
      UserPoolName: !Sub ClimbAssist${ResourceNameSuffix}
      AliasAttributes:
      - email
      Schema:
      - Name: email
        AttributeDataType: String
        Mutable: true
        Required: true
  CognitoUserPoolConfigurationFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub CognitoUserPoolConfigurationFunction${ResourceNameSuffix}
      Code:
        # This is a minified version of cloudformation_custom_resources/set_user_pool_properties.py because inline
        # Lambda functions have a limit of 4 KB.
        # This was created using https://dflook.github.io/python-minifier/
        # TODO automate this in some way in the future
        ZipFile: |
          d='aws4_request'
          F='utf-8'
          import cfnresponse as C,datetime as a,hashlib as E,hmac as K,json,logging as B,os,sys
          from botocore.vendored import requests as b
          D=B.getLogger()
          D.setLevel(B.INFO)
          def A(key,msg):return K.new(key,msg.encode(F),E.sha256).digest()
          def c(key,date_stamp,region_name,service_name):B=A(('AWS4'+key).encode(F),date_stamp);C=A(B,region_name);D=A(C,service_name);E=A(D,d);return E
          def handler(event,context):
              x=', ';w='UserPoolId';v='ResourceProperties';u='RequestType';Z=None;I='/';G=context;B=event;A='\n'
              try:
                  D.info('got event {}'.format(B))
                  if B[u]=='Update':C.send(B,G,C.FAILED,{});return
                  elif B[u]=='Create':
                      L=B[v][w];e=B[v]['SesEmailIdentity'];D.info('Setting properties for user pool {}'.format(L));f={w:L,'Policies':{'PasswordPolicy':{'MinimumLength':8}},'AutoVerifiedAttributes':['email'],'VerificationMessageTemplate':{'EmailSubjectByLink':'Climb Assist verification link','EmailMessageByLink':'Please click the link below to verify your email address.\n{##Verify Email##}','DefaultEmailOption':'CONFIRM_WITH_LINK'},'EmailConfiguration':{'SourceArn':e,'ReplyToEmailAddress':'no-reply@climbassist.com','EmailSendingAccount':'DEVELOPER'}};M=json.dumps(f);g='POST';N='cognito-idp';H=os.environ.get('AWS_DEFAULT_REGION');h='cognito-idp.{}.amazonaws.com'.format(H);i='https://cognito-idp.{}.amazonaws.com'.format(H);O='application/x-amz-json-1.0';P='AWSCognitoIdentityProviderService.UpdateUserPool';Q=os.environ.get('AWS_ACCESS_KEY_ID');R=os.environ.get('AWS_SECRET_ACCESS_KEY');S=os.environ.get('AWS_SESSION_TOKEN')
                      if Q is Z or R is Z or S is Z:D.error('No credentials available.');sys.exit()
                      T=a.datetime.utcnow();J=T.strftime('%Y%m%dT%H%M%SZ');U=T.strftime('%Y%m%d');j=I;k='';l='content-type:'+O+A+'host:'+h+A+'x-amz-date:'+J+A+'x-amz-target:'+P+A;V='content-type;host;x-amz-date;x-amz-target';m=E.sha256(M.encode(F)).hexdigest();n=g+A+j+A+k+A+l+A+V+A+m;W='AWS4-HMAC-SHA256';X=U+I+H+I+N+I+d;o=W+A+J+A+X+A+E.sha256(n.encode(F)).hexdigest();p=c(R,U,H,N);q=K.new(p,o.encode(F),E.sha256).hexdigest();r=W+' '+'Credential='+Q+I+X+x+'SignedHeaders='+V+x+'Signature='+q;s={'Content-Type':O,'X-Amz-Date':J,'X-Amz-Target':P,'Authorization':r,'X-Amz-Security-Token':S};Y=b.post(i,data=M,headers=s)
                      if Y.status_code!=200:D.error(Y.text);C.send(B,G,C.FAILED,{});return
                  C.send(B,G,C.SUCCESS,{})
              except Exception as t:D.error('caught exception {}'.format(t));C.send(B,G,C.FAILED,{})
      Handler: index.handler
      Runtime: python3.7
      Role:
        Fn::GetAtt:
        - CognitoUserPoolConfigurationRole
        - Arn
  CognitoUserPoolConfigurationRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub CognitoUserPoolConfigurationRole${ResourceNameSuffix}
      Policies:
      - PolicyName: CognitoUserPoolConfigurationPolicy
        PolicyDocument:
          Version: '2012-10-17'
          Statement:
          - Effect: Allow
            Action: cognito-idp:UpdateUserPool
            Resource:
              Fn::GetAtt:
              - UserPool
              - Arn
          - Effect: Allow
            Action: logs:*
            Resource: '*'
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Principal:
            Service: lambda.amazonaws.com
          Action: sts:AssumeRole
  # This is required because the AWS::Cognito::UserPool CloudFormation resource doesn't support the
  # EmailConfiguration.EmailSendingAccount property yet.
  CognitoUserPoolConfiguration:
    Type: Custom::CognitoUserPoolConfiguration
    Properties:
      ServiceToken:
        Fn::GetAtt:
        - CognitoUserPoolConfigurationFunction
        - Arn
      UserPoolId: !Ref UserPool
      SesEmailIdentity: !GetAtt SesVerifiedEmailIdentity.Arn
  UserPoolClient:
    Type: AWS::Cognito::UserPoolClient
    Properties:
      ClientName: ClimbAssist
      UserPoolId: !Ref UserPool
      WriteAttributes:
      - email
      ExplicitAuthFlows:
      - USER_PASSWORD_AUTH

  CognitoUserPoolDomainFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub CognitoUserPoolDomainFunction${ResourceNameSuffix}
      Code:
        ZipFile: |
          import cfnresponse
          import logging
          import boto3

          logger = logging.getLogger()
          logger.setLevel(logging.INFO)


          # We have to use raw HTTPS requests to the Cognito endpoint because the SDK that runs in Lambda doesn't support the
          # VerificationMessageTemplate.DefaultEmailOption yet
          def handler(event, context):
              try:
                  logger.info('got event {}'.format(event))

                  if event['RequestType'] == 'Update':
                      logger.info('Updates are not supported for this resource')
                      cfnresponse.send(event, context, cfnresponse.FAILED, {})
                      return

                  user_pool_id = event['ResourceProperties']['UserPoolId']
                  domain = event['ResourceProperties']['Domain']
                  cognito_idp = boto3.client('cognito-idp')

                  if event['RequestType'] == 'Create':
                      logger.info('Creating domain {} for user pool {}'.format(domain, user_pool_id))
                      cognito_idp.create_user_pool_domain(
                          UserPoolId=user_pool_id,
                          Domain=domain
                      )

                  elif event['RequestType'] == 'Delete':
                      logger.info('Deleting domain {} for user pool {}'.format(domain, user_pool_id))
                      cognito_idp.delete_user_pool_domain(
                          UserPoolId=user_pool_id,
                          Domain=domain
                      )

                  cfnresponse.send(event, context, cfnresponse.SUCCESS, {})
              except Exception as e:
                  logger.error('caught exception {}'.format(e))
                  cfnresponse.send(event, context, cfnresponse.FAILED, {})
      Handler: index.handler
      Runtime: python3.7
      Role:
        Fn::GetAtt:
        - CognitoUserPoolDomainRole
        - Arn
  CognitoUserPoolDomainRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub CognitoUserPoolDomainRole${ResourceNameSuffix}
      Policies:
      - PolicyName: CognitoUserPoolDomainPolicy
        PolicyDocument:
          Version: '2012-10-17'
          Statement:
          - Effect: Allow
            Action:
            - cognito-idp:CreateUserPoolDomain
            - cognito-idp:DeleteUserPoolDomain
            Resource: !GetAtt UserPool.Arn
          - Effect: Allow
            Action: logs:*
            Resource: '*'
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Principal:
            Service: lambda.amazonaws.com
          Action: sts:AssumeRole
  # This is required because there's no way to configure the domain for a user pool directly through native
  # CloudFormation resources
  CognitoUserPoolDomain:
    Type: Custom::CognitoUserPoolDomain
    Properties:
      ServiceToken: !GetAtt CognitoUserPoolDomainFunction.Arn
      UserPoolId: !Ref UserPool
      Domain: !Sub climbassist${ResourceNameSuffix}

  CognitoUserPoolAdministratorsGroup:
    Type: AWS::Cognito::UserPoolGroup
    Properties:
      UserPoolId: !Ref UserPool
      GroupName: Administrators
      Description: Climb Assist administrators. All members are manually added.

  SesVerifiedEmailIdentityFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub SesVerifiedEmailIdentityFunction${ResourceNameSuffix}
      Code:
        ZipFile: |
          import time

          import cfnresponse
          import logging
          import boto3

          logger = logging.getLogger()
          logger.setLevel(logging.INFO)


          def handler(event, context):
              try:
                  logger.info('got event {}'.format(event))

                  if event['RequestType'] == 'Update':
                      logger.error('Updates are not supported for this resource')
                      cfnresponse.send(event, context, cfnresponse.FAILED, {})
                      return

                  email = event['ResourceProperties']['Email']
                  ses = boto3.client('ses')

                  if event['RequestType'] == 'Create':
                      logger.info('Creating verified email for {}'.format(email))

                      ses.verify_email_identity(
                          EmailAddress=email
                      )

                      timeout_minutes = 12
                      end_time = time.time() + timeout_minutes * 60
                      is_verified = False
                      while time.time() < end_time and not is_verified:
                          time.sleep(1)
                          is_verified = ses.get_identity_verification_attributes(
                              Identities=[email]
                          )['VerificationAttributes'][email]['VerificationStatus'] == 'Success'

                      if is_verified:
                          lambda_arn = event['ServiceToken'].split(':')
                          response_data = {
                              'Arn': 'arn:{}:ses:{}:{}:identity/{}'.format(lambda_arn[1], lambda_arn[3], lambda_arn[4], email)
                          }
                          cfnresponse.send(event, context, cfnresponse.SUCCESS, response_data)
                      else:
                          cfnresponse.send(event, context, cfnresponse.FAILED, {})

                  elif event['RequestType'] == 'Delete':
                      logger.info('Deleting email identity for {}'.format(email))
                      ses.delete_identity(
                          Identity=email
                      )
                      cfnresponse.send(event, context, cfnresponse.SUCCESS, {})
              except Exception as e:
                  logger.error('caught exception {}'.format(e))
                  cfnresponse.send(event, context, cfnresponse.FAILED, {})
      Handler: index.handler
      Runtime: python3.7
      Timeout: 900 # 15 minutes
      Role:
        Fn::GetAtt:
        - SesVerifiedEmailIdentityRole
        - Arn
  SesVerifiedEmailIdentityRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub SesVerifiedEmailIdentityRole${ResourceNameSuffix}
      Policies:
      - PolicyName: SesVerifiedEmailIdentityPolicy
        PolicyDocument:
          Version: '2012-10-17'
          Statement:
          - Effect: Allow
            Action:
            - ses:VerifyEmailIdentity
            - ses:GetIdentityVerificationAttributes
            - ses:DeleteIdentity
            Resource: '*'
          - Effect: Allow
            Action: logs:*
            Resource: '*'
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Principal:
            Service: lambda.amazonaws.com
          Action: sts:AssumeRole
  # This is required because SES doesn't provide a way to create or verify an email identity through CloudFormation
  SesVerifiedEmailIdentity:
    Type: Custom::SesVerifiedEmailIdentity
    Properties:
      ServiceToken:
        Fn::GetAtt:
        - SesVerifiedEmailIdentityFunction
        - Arn
      Email:
        Fn::If:
        - IsProd
        - info@climbassist.com
        # this strips out the '-' from the beginning of ResourceNameSuffix and then appends '@climbassist.com'
        - !Sub
          - ${Name}@climbassist.com
          - { Name: !Select [1, !Split ['-', !Ref ResourceNameSuffix]] }

  RecaptchaBackDoorResponseSecret:
    Type: AWS::SecretsManager::Secret
    Properties:
      Name: !Sub RecaptchaBackDoorResponse${ResourceNameSuffix}
      Description: Allow-listed reCAPTCHA response for which any reCAPTCHA-enabled API will accept successfully. This is mainly used for automated testing so that reCAPTCHA-enabled APIs can be tested.
  #      GenerateSecretString:
  #        SecretStringTemplate: '{}'
  #        GenerateStringKey: 'backDoorResponse'
  RecaptchaBackDoorResponseRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub RecaptchaBackDoorResponseRole${ResourceNameSuffix}
      Policies:
      - PolicyName: RecaptchaBackDoorResponsePolicy
        PolicyDocument:
          Version: '2012-10-17'
          Statement:
          - Effect: Allow
            Action: logs:*
            Resource: '*'
          - Effect: Allow
            Action: secretsmanager:GetRandomPassword
            Resource: '*'
          - Effect: Allow
            Action:
            - secretsmanager:DescribeSecret
            - secretsmanager:GetSecretValue
            - secretsmanager:PutSecretValue
            - secretsmanager:UpdateSecretVersionStage
            Resource: !Ref RecaptchaBackDoorResponseSecret
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Principal:
            Service: lambda.amazonaws.com
          Action: sts:AssumeRole
  RecaptchaBackDoorResponseRotationFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub RecaptchaBackDoorResponseRotationFunction${ResourceNameSuffix}
      Code:
        ZipFile: |
          import logging

          logger = logging.getLogger()
          logger.setLevel(logging.INFO)
          import boto3


          def handler(event, context):
              logger.info('got event {}'.format(event))
              secrets_manager = boto3.client('secretsmanager')
              if event['Step'] == 'createSecret':
                  logger.info('creating new secret')
                  try:
                      secrets_manager.get_secret_value(SecretId=event['SecretId'], VersionId=event['ClientRequestToken'], VersionStage="AWSPENDING")
                      logger.info('successfully retrieved secret.')
                  except secrets_manager.exceptions.ResourceNotFoundException:
                      new_secret = secrets_manager.get_random_password()['RandomPassword']
                      secrets_manager.put_secret_value(SecretId=event['SecretId'], ClientRequestToken=event['ClientRequestToken'], SecretString=new_secret, VersionStages=['AWSPENDING'])
                      logger.info('saved new secret')
              elif event['Step'] == 'finishSecret':
                  logger.info('finishing secret')
                  metadata = secrets_manager.describe_secret(SecretId=event['SecretId'])
                  current_version = None
                  for version in metadata['VersionIdsToStages']:
                      if 'AWSCURRENT' in metadata['VersionIdsToStages'][version]:
                          if version == event['ClientRequestToken']:
                              logger.info('finishSecret: Version already marked as AWSCURRENT')
                              return
                          current_version = version
                          break

                  secrets_manager.update_secret_version_stage(SecretId=event['SecretId'], VersionStage="AWSCURRENT", MoveToVersionId=event['ClientRequestToken'], RemoveFromVersionId=current_version)
                  logger.info('finished secret')
              else:
                  logger.info('skipping')
                  pass
      Handler: index.handler
      Runtime: python3.7
      Timeout: 60 # 15 minutes
      Role: !GetAtt RecaptchaBackDoorResponseRole.Arn
  RecaptchaBackDoorResponseRotationFunctionPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !GetAtt RecaptchaBackDoorResponseRotationFunction.Arn
      Action: lambda:InvokeFunction
      Principal: secretsmanager.amazonaws.com
  RecaptchaBackDoorResponseSecretRotationSchedule:
    Type: AWS::SecretsManager::RotationSchedule
    Properties:
      SecretId: !Ref RecaptchaBackDoorResponseSecret
      RotationLambdaARN: !GetAtt RecaptchaBackDoorResponseRotationFunction.Arn
      RotationRules:
        AutomaticallyAfterDays: 1

  CloudWatchDashboard:
    Type: AWS::CloudWatch::Dashboard
    Properties:
      DashboardName: !Sub ClimbAssistDashboard${ResourceNameSuffix}
      DashboardBody: !Sub |
        {
          "start": "-P7D",
          "periodOverride": "inherit",
          "widgets": [
            {
              "type": "metric",
              "x": 6,
              "y": 0,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "HealthCheck",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "HealthCheck",
                "period": 60,
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                },
                "legend": {
                  "position": "bottom"
                }
              }
            },
            {
              "type": "metric",
              "x": 12,
              "y": 7,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "CreateCountry",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "CreateCountry",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 39,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "DeleteArea",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "DeleteArea",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 12,
              "y": 65,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "UploadCragPhoto",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "UploadCragPhoto",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 12,
              "y": 20,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "CreateRegion",
                    {
                      "stat": "Sum",
                      "period": 60
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "CreateRegion",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 0,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "Index",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "Index",
                "period": 60,
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 6,
              "y": 117,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "DeletePoint",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "DeletePoint",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 12,
              "y": 117,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "BatchDeletePoints",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "BatchDeletePoints",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 6,
              "y": 33,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "ListAreas",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "ListAreas",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 6,
              "y": 7,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "ListCountries",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "ListCountries",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 20,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "GetRegion",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "GetRegion",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 6,
              "y": 20,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "ListRegions",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "ListRegions",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 26,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "DeleteRegion",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "DeleteRegion",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 7,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "GetCountry",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "GetCountry",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 18,
              "y": 7,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "UpdateCountry",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "UpdateCountry",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "text",
              "x": 0,
              "y": 6,
              "width": 24,
              "height": 1,
              "properties": {
                "markdown": "\n# Country APIs\n"
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 13,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "DeleteCountry",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "DeleteCountry",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "text",
              "x": 0,
              "y": 71,
              "width": 24,
              "height": 1,
              "properties": {
                "markdown": "\n# Wall APIs\n"
              }
            },
            {
              "type": "metric",
              "x": 18,
              "y": 20,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "UpdateRegion",
                    {
                      "stat": "Sum",
                      "period": 60
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "UpdateRegion",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "text",
              "x": 0,
              "y": 19,
              "width": 24,
              "height": 1,
              "properties": {
                "markdown": "\n# Region APIs\n"
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 33,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "GetArea",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "GetArea",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 12,
              "y": 33,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "CreateArea",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "CreateArea",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 18,
              "y": 33,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "UpdateArea",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "UpdateArea",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "text",
              "x": 0,
              "y": 32,
              "width": 24,
              "height": 1,
              "properties": {
                "markdown": "\n# Area APIs\n"
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 46,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "GetSubArea",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "GetSubArea",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 52,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "DeleteSubArea",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "DeleteSubArea",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 12,
              "y": 46,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "CreateSubArea",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "CreateSubArea",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 18,
              "y": 46,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "UpdateSubArea",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "UpdateSubArea",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "text",
              "x": 0,
              "y": 45,
              "width": 24,
              "height": 1,
              "properties": {
                "markdown": "\n# Sub-Area APIs\n"
              }
            },
            {
              "type": "metric",
              "x": 6,
              "y": 46,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "ListSubAreas",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "ListSubAreas",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 78,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "DeleteWall",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "DeleteWall",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 18,
              "y": 59,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "UpdateCrag",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "UpdateCrag",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 12,
              "y": 59,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "CreateCrag",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "CreateCrag",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 6,
              "y": 59,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "ListCrags",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "ListCrags",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "text",
              "x": 0,
              "y": 58,
              "width": 24,
              "height": 1,
              "properties": {
                "markdown": "\n# Crag APIs\n"
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 59,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "GetCrag",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "GetCrag",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 18,
              "y": 72,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "UpdateWall",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "UpdateWall",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 12,
              "y": 72,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "CreateWall",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "CreateWall",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 72,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "GetWall",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "GetWall",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 6,
              "y": 72,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "ListWalls",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "ListWalls",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "text",
              "x": 0,
              "y": 84,
              "width": 24,
              "height": 1,
              "properties": {
                "markdown": "\n# Route APIs\n"
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 104,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "DeletePitch",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "DeletePitch",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 91,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "DeleteRoute",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "DeleteRoute",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 18,
              "y": 85,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "UpdateRoute",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "UpdateRoute",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 12,
              "y": 85,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "CreateRoute",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "CreateRoute",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 6,
              "y": 85,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "ListRoutes",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "ListRoutes",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 85,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "GetRoute",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "GetRoute",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "text",
              "x": 0,
              "y": 97,
              "width": 24,
              "height": 1,
              "properties": {
                "markdown": "\n# Pitch APIs\n"
              }
            },
            {
              "type": "metric",
              "x": 18,
              "y": 98,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "UpdatePitch",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "UpdatePitch",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 12,
              "y": 98,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "CreatePitch",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "CreatePitch",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 6,
              "y": 98,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "ListPitches",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "ListPitches",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 98,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "GetPitch",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "GetPitch",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "text",
              "x": 0,
              "y": 110,
              "width": 24,
              "height": 1,
              "properties": {
                "markdown": "\n# Point APIs\n"
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 117,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "UpdatePoint",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "UpdatePoint",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 12,
              "y": 111,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "CreatePoint",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "CreatePoint",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 18,
              "y": 111,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "BatchCreatePoints",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "BatchCreatePoints",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 6,
              "y": 111,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "ListPoints",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "ListPoints",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 124,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "RegisterUser",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "RegisterUser",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 65,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "DeleteCrag",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "DeleteCrag",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 6,
              "y": 65,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "UploadCragModel",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "UploadCragModel",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 6,
              "y": 91,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "UploadRoutePhoto",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "UploadRoutePhoto",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "text",
              "x": 0,
              "y": 123,
              "width": 24,
              "height": 1,
              "properties": {
                "markdown": "\n# User APIs\n"
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 111,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "GetPoint",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "GetPoint",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 6,
              "y": 124,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "SignIn",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "SignIn",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 12,
              "y": 124,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "SignOut",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "SignOut",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 130,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "VerifyEmail",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "VerifyEmail",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 18,
              "y": 124,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "DeleteUser",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "DeleteUser",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 6,
              "y": 130,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "SendVerificationEmail",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "SendVerificationEmail",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 12,
              "y": 130,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "ChangePassword",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "ChangePassword",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 136,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "ResetPassword",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "ResetPassword",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 18,
              "y": 130,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "SendPasswordResetEmail",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "SendPasswordResetEmail",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 6,
              "y": 136,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "GetUser",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "GetUser",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "metric",
              "x": 12,
              "y": 136,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "UpdateUser",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "UpdateUser",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "type": "text",
              "x": 0,
              "y": 142,
              "width": 24,
              "height": 1,
              "properties": {
                "markdown": "\n# Contact APIs\n"
              }
            },
            {
              "type": "metric",
              "x": 0,
              "y": 143,
              "width": 6,
              "height": 6,
              "properties": {
                "metrics": [
                  [
                    "ClimbAssist${ResourceNameSuffix}",
                    "faultCount",
                    "api",
                    "SendContactEmail",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "errorCount",
                    ".",
                    ".",
                    {
                      "stat": "Sum",
                      "period": 60,
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "duration",
                    ".",
                    ".",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p50",
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    {
                      "yAxis": "right",
                      "period": 60,
                      "stat": "p90",
                      "color": "#1f77b4"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-2",
                "title": "SendContactEmail",
                "period": 60,
                "legend": {
                  "position": "bottom"
                },
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                }
              }
            }
          ]
        }


  CloudWatchUsageDashboard:
    Type: AWS::CloudWatch::Dashboard
    Properties:
      DashboardName: !Sub ClimbAssistUsageDashboard${ResourceNameSuffix}
      DashboardBody: !Sub |
        {
          "widgets": [
            {
              "type": "log",
              "x": 0,
              "y": 0,
              "width": 6,
              "height": 6,
              "properties": {
                "query": "SOURCE '/aws/elasticbeanstalk/climbassistapp${ResourceNameSuffix}/var/log/application.log' | fields @timestamp, @message\n| filter @message like \"Request:\"\n| parse \"\\\"path\\\":\\\"*\\\"\" as path\n| filter path like /^\\/v1\\/countries\\/[^\\/]+$/\n| parse \"\\\"path\\\":\\\"/v1/countries/*\\\"\" as countryId\n| stats count() as count by countryId\n| sort count desc",
                "region": "us-west-2",
                "stacked": false,
                "title": "GetCountry",
                "view": "table"
              }
            },
            {
              "type": "log",
              "x": 12,
              "y": 6,
              "width": 6,
              "height": 6,
              "properties": {
                "query": "SOURCE '/aws/elasticbeanstalk/climbassistapp${ResourceNameSuffix}/var/log/application.log' | fields @timestamp, @message\n| filter @message like \"Request:\"\n| parse \"\\\"path\\\":\\\"*\\\"\" as path\n| filter path like /^\\/v1\\/sub-areas\\/[^\\/]+$/\n| parse \"\\\"path\\\":\\\"/v1/sub-areas/*\\\"\" as subAreaId\n| stats count() as count by subAreaId\n| sort count desc",
                "region": "us-west-2",
                "stacked": false,
                "title": "GetSubArea",
                "view": "table"
              }
            },
            {
              "type": "log",
              "x": 18,
              "y": 12,
              "width": 6,
              "height": 6,
              "properties": {
                "query": "SOURCE '/aws/elasticbeanstalk/climbassistapp${ResourceNameSuffix}/var/log/application.log' | fields @timestamp, @message\n| filter @message like \"Request:\"\n| parse \"\\\"path\\\":\\\"*\\\"\" as path\n| filter path like /^\\/v1\\/walls\\/[^\\/]+\\/routes$/\n| parse \"\\\"path\\\":\\\"/v1/walls/*/routes\\\"\" as wallId\n| stats count() as count by wallId\n| sort count desc",
                "region": "us-west-2",
                "stacked": false,
                "title": "ListRoutes",
                "view": "table"
              }
            },
            {
              "type": "log",
              "x": 12,
              "y": 0,
              "width": 6,
              "height": 6,
              "properties": {
                "query": "SOURCE '/aws/elasticbeanstalk/climbassistapp${ResourceNameSuffix}/var/log/application.log' | fields @timestamp, @message\n| filter @message like \"Request:\"\n| parse \"\\\"path\\\":\\\"*\\\"\" as path\n| filter path like /^\\/v1\\/regions\\/[^\\/]+$/\n| parse \"\\\"path\\\":\\\"/v1/regions/*\\\"\" as regionId\n| stats count() as count by regionId\n| sort count desc",
                "region": "us-west-2",
                "stacked": false,
                "title": "GetRegion",
                "view": "table"
              }
            },
            {
              "type": "log",
              "x": 6,
              "y": 0,
              "width": 6,
              "height": 6,
              "properties": {
                "query": "SOURCE '/aws/elasticbeanstalk/climbassistapp${ResourceNameSuffix}/var/log/application.log' | fields @timestamp, @message\n| filter @message like \"Request:\"\n| parse \"\\\"path\\\":\\\"*\\\"\" as path\n| filter path like /^\\/v1\\/countries\\/[^\\/]+\\/regions$/\n| parse \"\\\"path\\\":\\\"/v1/countries/*/regions\\\"\" as countryId\n| stats count() as count by countryId\n| sort count desc",
                "region": "us-west-2",
                "stacked": false,
                "title": "ListRegions",
                "view": "table"
              }
            },
            {
              "type": "log",
              "x": 18,
              "y": 0,
              "width": 6,
              "height": 6,
              "properties": {
                "query": "SOURCE '/aws/elasticbeanstalk/climbassistapp${ResourceNameSuffix}/var/log/application.log' | fields @timestamp, @message\n| filter @message like \"Request:\"\n| parse \"\\\"path\\\":\\\"*\\\"\" as path\n| filter path like /^\\/v1\\/regions\\/[^\\/]+\\/areas$/\n| parse \"\\\"path\\\":\\\"/v1/regions/*/areas\\\"\" as regionId\n| stats count() as count by regionId\n| sort count desc",
                "region": "us-west-2",
                "stacked": false,
                "title": "ListAreas",
                "view": "table"
              }
            },
            {
              "type": "log",
              "x": 0,
              "y": 6,
              "width": 6,
              "height": 6,
              "properties": {
                "query": "SOURCE '/aws/elasticbeanstalk/climbassistapp${ResourceNameSuffix}/var/log/application.log' | fields @timestamp, @message\n| filter @message like \"Request:\"\n| parse \"\\\"path\\\":\\\"*\\\"\" as path\n| filter path like /^\\/v1\\/areas\\/[^\\/]+$/\n| parse \"\\\"path\\\":\\\"/v1/areas/*\\\"\" as areaId\n| stats count() as count by areaId\n| sort count desc",
                "region": "us-west-2",
                "stacked": false,
                "title": "GetArea",
                "view": "table"
              }
            },
            {
              "type": "log",
              "x": 6,
              "y": 6,
              "width": 6,
              "height": 6,
              "properties": {
                "query": "SOURCE '/aws/elasticbeanstalk/climbassistapp${ResourceNameSuffix}/var/log/application.log' | fields @timestamp, @message\n| filter @message like \"Request:\"\n| parse \"\\\"path\\\":\\\"*\\\"\" as path\n| filter path like /^\\/v1\\/areas\\/[^\\/]+\\/sub-areas$/\n| parse \"\\\"path\\\":\\\"/v1/areas/*/sub-areas\\\"\" as areaId\n| stats count() as count by areaId\n| sort count desc",
                "region": "us-west-2",
                "stacked": false,
                "title": "ListSubAreas",
                "view": "table"
              }
            },
            {
              "type": "log",
              "x": 18,
              "y": 6,
              "width": 6,
              "height": 6,
              "properties": {
                "query": "SOURCE '/aws/elasticbeanstalk/climbassistapp${ResourceNameSuffix}/var/log/application.log' | fields @timestamp, @message\n| filter @message like \"Request:\"\n| parse \"\\\"path\\\":\\\"*\\\"\" as path\n| filter path like /^\\/v1\\/sub-areas\\/[^\\/]+\\/crags$/\n| parse \"\\\"path\\\":\\\"/v1/sub-areas/*/crags\\\"\" as subAreaId\n| stats count() as count by subAreaId\n| sort count desc",
                "region": "us-west-2",
                "stacked": false,
                "title": "ListCrags",
                "view": "table"
              }
            },
            {
              "type": "log",
              "x": 0,
              "y": 12,
              "width": 6,
              "height": 6,
              "properties": {
                "query": "SOURCE '/aws/elasticbeanstalk/climbassistapp${ResourceNameSuffix}/var/log/application.log' | fields @timestamp, @message\n| filter @message like \"Request:\"\n| parse \"\\\"path\\\":\\\"*\\\"\" as path\n| filter path like /^\\/v1\\/crags\\/[^\\/]+$/\n| parse \"\\\"path\\\":\\\"/v1/crags/*\\\"\" as cragId\n| stats count() as count by cragId\n| sort count desc\n",
                "region": "us-west-2",
                "stacked": false,
                "title": "GetCrag",
                "view": "table"
              }
            },
            {
              "type": "log",
              "x": 0,
              "y": 18,
              "width": 6,
              "height": 6,
              "properties": {
                "query": "SOURCE '/aws/elasticbeanstalk/climbassistapp${ResourceNameSuffix}/var/log/application.log' | fields @timestamp, @message\n| filter @message like \"Request:\"\n| parse \"\\\"path\\\":\\\"*\\\"\" as path\n| filter path like /^\\/v1\\/routes\\/[^\\/]+$/\n| parse \"\\\"path\\\":\\\"/v1/routes/*\\\"\" as routeId\n| stats count() as count by routeId\n| sort count desc\n",
                "region": "us-west-2",
                "stacked": false,
                "title": "GetRoute",
                "view": "table"
              }
            },
            {
              "type": "log",
              "x": 6,
              "y": 12,
              "width": 6,
              "height": 6,
              "properties": {
                "query": "SOURCE '/aws/elasticbeanstalk/climbassistapp${ResourceNameSuffix}/var/log/application.log' | fields @timestamp, @message\n| filter @message like \"Request:\"\n| parse \"\\\"path\\\":\\\"*\\\"\" as path\n| filter path like /^\\/v1\\/crags\\/[^\\/]+\\/walls$/\n| parse \"\\\"path\\\":\\\"/v1/crags/*/walls\\\"\" as cragId\n| stats count() as count by cragId\n| sort count desc",
                "region": "us-west-2",
                "stacked": false,
                "title": "ListWalls",
                "view": "table"
              }
            },
            {
              "type": "log",
              "x": 12,
              "y": 12,
              "width": 6,
              "height": 6,
              "properties": {
                "query": "SOURCE '/aws/elasticbeanstalk/climbassistapp${ResourceNameSuffix}/var/log/application.log' | fields @timestamp, @message\n| filter @message like \"Request:\"\n| parse \"\\\"path\\\":\\\"*\\\"\" as path\n| filter path like /^\\/v1\\/walls\\/[^\\/]+$/\n| parse \"\\\"path\\\":\\\"/v1/walls/*\\\"\" as wallId\n| stats count() as count by wallId\n| sort count desc\n",
                "region": "us-west-2",
                "stacked": false,
                "title": "GetWall",
                "view": "table"
              }
            }
          ]
        }
